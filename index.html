<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –ø—Ä–æ—Ñ–∏–ª—å ‚Äî Supabase</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
</head>
<body>
  <h1>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è + –ü—Ä–æ—Ñ–∏–ª—å</h1>

  <input id="full_name" type="text" placeholder="–í–∞—à–µ –∏–º—è">
  <input id="email" type="email" placeholder="Email">
  <input id="password" type="password" placeholder="–ü–∞—Ä–æ–ª—å">
  <br>
  <button onclick="signUp()">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
  <button onclick="signIn()">–í—Ö–æ–¥</button>
  <button onclick="signOut()">–í—ã—Ö–æ–¥</button>

  <p id="message"></p>
  <p id="user-info"></p>

  <script>
    // üîê –í—Å—Ç–∞–≤—å —Å—é–¥–∞ —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ
    const SUPABASE_URL = 'https://–í–ê–®-–ü–†–û–ï–ö–¢.supabase.co';
    const SUPABASE_ANON_KEY = '–í–ê–®_ANON_KEY';
    const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    async function signUp() {
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      const fullName = document.getElementById('full_name').value;

      // –®–∞–≥ 1: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      const { data, error } = await supabase.auth.signUp({ email, password });

      if (error) {
        document.getElementById('message').innerText = error.message;
        return;
      }

      const user = data.user;
      document.getElementById('message').innerText = '–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ email –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏';

      // –®–∞–≥ 2: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ user —É–∂–µ —Å–æ–∑–¥–∞–Ω)
      if (user) {
        const { error: insertError } = await supabase
          .from('profiles')
          .insert([
            {
              id: user.id,
              full_name: fullName,
              created_at: new Date().toISOString()
            }
          ]);

        if (insertError) {
          console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è:', insertError.message);
        }
      }
    }

    async function signIn() {
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;

      const { data, error } = await supabase.auth.signInWithPassword({ email, password });

      if (error) {
        document.getElementById('message').innerText = error.message;
      } else {
        document.getElementById('message').innerText = '–í—ã –≤–æ—à–ª–∏!';
        showUser();
      }
    }

    async function signOut() {
      await supabase.auth.signOut();
      document.getElementById('message').innerText = '–í—ã –≤—ã—à–ª–∏';
      showUser();
    }

    async function showUser() {
      const { data: { user } } = await supabase.auth.getUser();
      document.getElementById('user-info').innerText = user ? `–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${user.email}` : '–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω';
    }

    showUser();
  </script>
</body>
</html>
